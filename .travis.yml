language: node_js
node_js: node

env:
  global:
    # - NETLIFY_AUTH_TOKEN is specified in the UI elsewhere
    - NETLIFY_SITE_ID=e5b3d64d-7241-4bea-a328-31aee9a3b722

branches:
  only:
    - master

git:
  clone: false

cache: yarn

before_install:
  - yarn global add netlify-cli
  - git clone https://github.com/ludobrew/gatsby-theme-ludobrew-core.git
  - git clone https://github.com/ludobrew/gatsby-theme-ludobrew-exalted-3e.git
  - git clone https://github.com/Everspace/ludobrew-exalted-3e.git
  - >-
      echo
      '{
        "name": "my-workspace",
        "private": true,
        "workspaces": [
          "gatsby-theme-ludobrew-core",
          "gatsby-theme-ludobrew-exalted-3e",
          "ludobrew-exalted-3e"
        ]
      }'
      > package.json

install: yarn
script:
  - yarn workspace ludobrew-exalted-3e build
  - netlify deploy --dir=ludobrew-exalted-3e/public --prod --auth $NETLIFY_AUTH_TOKEN
